%==============================================================================
% Beamer style for the beamer template posted at
% https://github.com/acoache/knitr-beamer-3colors
% 
% Created by Anthony Coache (anthony.coache@gmail.com) in January 2020
% Modified by Anthony Coache (anthony.coache@gmail.com) in April 2021
% =============================================================================

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%                         Packages section
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Name of the package
\ProvidesPackage{beamerthemeknitr-beamer-3colors}
\RequirePackage[T1]{fontenc}
\RequirePackage{lmodern} % High quality font

% Beamer options for theme colors
\DeclareOption{LightTheme}{\@doLightThemetrue}
\DeclareOption{DarkTheme}{\@doDarkThemetrue}
\DeclareOption{BlackAndWhite}{\@doBlackAndWhitetrue}
\DeclareOption{MetropolisTheme}{\@doMetropolisThemetrue}
\DeclareOption{InformsTheme}{\@doInformsThemetrue}

% Beamer options for numbering styles
\DeclareOption{HeadNumber}{\@doHeadNumbertrue}
\DeclareOption{FootNumber}{\@doFootNumbertrue}

% Beamer option for a watermark figure
\DeclareOption{Watermark}{\@doWatermarktrue}

% Conditions for themes
\newif\if@doDarkTheme
\@doDarkThemefalse
\newif\if@doBlackAndWhite
\@doBlackAndWhitefalse
\newif\if@doMetropolisTheme
\@doMetropolisThemefalse
\newif\if@doInformsTheme
\@doInformsThemefalse
\newif\if@doLightTheme
\@doLightThemefalse

% Conditions for numbering styles
\newif\if@doHeadNumber
\@doHeadNumberfalse
\newif\if@doFootNumber
\@doFootNumberfalse

% Condition for watermark
\newif\if@doWatermark
\@doWatermarkfalse

\ProcessOptions

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%                     Colors customization section
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\if@doDarkTheme
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%                            DARK THEME
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Define colors
\definecolor{mgreen}{rgb}{0,0.455,0.247}
\definecolor{mblue}{rgb}{0.098,0.18,0.357}
\definecolor{mred}{rgb}{0.949,0.431,0.016}
\definecolor{mgrey}{rgb}{0.90,0.90,0.90}
\definecolor{mblack}{rgb}{0,0,0}

\definecolor{FrameTitleLeft}{rgb}{0.098,0.18,0.357}
\definecolor{FrameTitleRight}{rgb}{0.1786,0.2531,0.4200}

% Set different colors
\colorlet{mblockBgColor}{mblue!20}
\colorlet{mblockTitleBgColor}{mblue!30}
\colorlet{mblockTitleTextColor}{mblue}

\colorlet{defntBgColor}{mgreen!20}
\colorlet{defntTitleBgColor}{mgreen!30}
\colorlet{defntTitleTextColor}{mgreen}

\colorlet{thmBgColor}{mred!20}
\colorlet{thmTitleBgColor}{mred!30}
\colorlet{thmTitleTextColor}{mred}

\colorlet{MainColor}{mblue}
\colorlet{BgColor}{mblue!10}
\colorlet{NormalTextColor}{black!90}
\colorlet{TitleTextColor}{white}
\colorlet{TitleBgColor}{mblue}
\colorlet{LinkColor}{mgreen}
\colorlet{CaptionColor}{mgreen}
\colorlet{AlertColor}{mred}
\colorlet{HeadlineTextColor}{mblue}
\colorlet{FootlineTextColor}{black!90}


%%%%%-- End of DARK THEME --%%%%%
\else
\if@doBlackAndWhite
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%                            BLACK AND WHITE THEME
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Define colors
\definecolor{mblue}{rgb}{0.15,0.15,0.15}
\definecolor{mred}{rgb}{0.40,0.40,0.40}
\definecolor{mgreen}{rgb}{0.90,0.90,0.90}
\definecolor{mblack}{rgb}{0,0,0}
\definecolor{mwhite}{rgb}{1,1,1}

\colorlet{FrameTitleLeft}{mblack}
\colorlet{FrameTitleRight}{mgreen}

% Set different colors
\colorlet{mblockBgColor}{mred!20}
\colorlet{mblockTitleBgColor}{mred!30}
\colorlet{mblockTitleTextColor}{mred}

\colorlet{defntBgColor}{mred!20}
\colorlet{defntTitleBgColor}{mred!30}
\colorlet{defntTitleTextColor}{mred}

\colorlet{thmBgColor}{mblue!20}
\colorlet{thmTitleBgColor}{mblue!30}
\colorlet{thmTitleTextColor}{mblue}

\colorlet{MainColor}{mblack}
\colorlet{BgColor}{mwhite}
\colorlet{NormalTextColor}{black!90}
\colorlet{TitleTextColor}{mwhite}
\colorlet{TitleBgColor}{mblack}
\colorlet{LinkColor}{mred}
\colorlet{CaptionColor}{mblack}
\colorlet{AlertColor}{mred}
\colorlet{HeadlineTextColor}{mblack}
\colorlet{FootlineTextColor}{mblack!90}


%%%%%-- End of BLACK AND WHITE THEME --%%%%%
\else
\if@doMetropolisTheme
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%                            METROPOLIS THEME
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Define colors
\definecolor{mbrown}{HTML}{604c38}
\definecolor{mblue}{HTML}{23373b}
\definecolor{mred}{HTML}{EB811B}
\definecolor{mgreen}{HTML}{14B03D}
\definecolor{mblack}{rgb}{0,0,0}
\definecolor{mwhite}{rgb}{1,1,1}

\colorlet{FrameTitleLeft}{mblue}
\colorlet{FrameTitleRight}{mblue}

% Set different colors
\colorlet{mblockBgColor}{mred!20}
\colorlet{mblockTitleBgColor}{mred!30}
\colorlet{mblockTitleTextColor}{mred}

\colorlet{defntBgColor}{mbrown!20}
\colorlet{defntTitleBgColor}{mbrown!30}
\colorlet{defntTitleTextColor}{mbrown}

\colorlet{thmBgColor}{mblue!20}
\colorlet{thmTitleBgColor}{mblue!30}
\colorlet{thmTitleTextColor}{mblue}

\colorlet{MainColor}{mblue}
\colorlet{BgColor}{mwhite}
\colorlet{NormalTextColor}{black!90}
\colorlet{TitleTextColor}{mwhite}
\colorlet{TitleBgColor}{mblue}
\colorlet{LinkColor}{mgreen}
\colorlet{CaptionColor}{mred}
\colorlet{AlertColor}{mred}
\colorlet{HeadlineTextColor}{mblue!90}
\colorlet{FootlineTextColor}{mblue!90}


%%%%%-- End of METROPOLIS THEME --%%%%%
\else
\if@doInformsTheme
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%                            INFORMS THEME
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Define colors
\definecolor{mgreen}{rgb}{0.00392,0.47059,0.24314}
\definecolor{mblue}{rgb}{0.098,0.18,0.357}
\definecolor{mred}{rgb}{1.0,0.0,0.48627}
\definecolor{mgrey}{rgb}{0.10,0.10,0.10}
\definecolor{mblack}{rgb}{0.04706,0.15294,0.0902}
\definecolor{FrameTitleLeft}{rgb}{0.00392,0.47059,0.24314}
\definecolor{FrameTitleRight}{rgb}{0.5451,0.76471,0.32941}

% Set different colors
\colorlet{mblockBgColor}{mblack!20}
\colorlet{mblockTitleBgColor}{mblack!30}
\colorlet{mblockTitleTextColor}{mblack}

\colorlet{defntBgColor}{mblack!20}
\colorlet{defntTitleBgColor}{mblack!30}
\colorlet{defntTitleTextColor}{mblack}

\colorlet{thmBgColor}{mred!20}
\colorlet{thmTitleBgColor}{mred!30}
\colorlet{thmTitleTextColor}{mred}

\colorlet{MainColor}{mgreen}
\colorlet{BgColor}{white}
\colorlet{NormalTextColor}{black!90}
\colorlet{TitleTextColor}{white}
\colorlet{TitleBgColor}{mgreen}
\colorlet{LinkColor}{mblue}
\colorlet{CaptionColor}{mblue}
\colorlet{AlertColor}{mred}
\colorlet{HeadlineTextColor}{mblue}
\colorlet{FootlineTextColor}{mblack!90}


%%%%%-- End of INFORMS THEME --%%%%%
\else
\if@doLightTheme
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%                            LIGHT THEME
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Define colors
\definecolor{mgreen}{rgb}{0,0.6,0.35}
\definecolor{mblue}{rgb}{0,0.4,0.6}
\definecolor{mred}{rgb}{0.9,0.3,0}
\definecolor{mgrey}{rgb}{0.85,0.85,0.85}
\definecolor{mblack}{rgb}{0,0,0}
\definecolor{FrameTitleLeft}{rgb}{0.85,0.85,0.85}
\definecolor{FrameTitleRight}{rgb}{0.98,0.98,0.98}

% Set different colors
\colorlet{mblockBgColor}{mgrey}
\colorlet{mblockTitleBgColor}{mgrey}
\colorlet{mblockTitleTextColor}{mblue}

\colorlet{defntBgColor}{white}
\colorlet{defntTitleBgColor}{white}
\colorlet{defntTitleTextColor}{mblue}

\colorlet{thmBgColor}{mgrey}
\colorlet{thmTitleBgColor}{mgrey}
\colorlet{thmTitleTextColor}{mred}

\colorlet{MainColor}{mblue}
\colorlet{BgColor}{white}
\colorlet{NormalTextColor}{black!90}
\colorlet{TitleTextColor}{mblue}
\colorlet{TitleBgColor}{mgrey}
\colorlet{LinkColor}{mblue}
\colorlet{CaptionColor}{mblue}
\colorlet{AlertColor}{mred}

\colorlet{HeadlineTextColor}{mblue}
\colorlet{FootlineTextColor}{black!60}


%%%%%-- End of LIGHT THEME --%%%%%
\else
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%                            BASIC THEME
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Define colors
\colorlet{mgreen}{green}
\colorlet{mblue}{blue}
\colorlet{mred}{red}
\colorlet{mblack}{black}
\colorlet{grey}{gray}
\colorlet{FrameTitleLeft}{gray}
\colorlet{FrameTitleRight}{white}

% Set different colors
\colorlet{mblockBgColor}{gray}
\colorlet{mblockTitleBgColor}{gray}
\colorlet{mblockTitleTextColor}{blue}

\colorlet{defntBgColor}{white}
\colorlet{defntTitleBgColor}{white}
\colorlet{defntTitleTextColor}{blue}

\colorlet{thmBgColor}{gray}
\colorlet{thmTitleBgColor}{gray}
\colorlet{thmTitleTextColor}{red}

\colorlet{MainColor}{blue}
\colorlet{BgColor}{white}
\colorlet{NormalTextColor}{black!90}
\colorlet{TitleTextColor}{blue}
\colorlet{TitleBgColor}{gray}
\colorlet{LinkColor}{blue}
\colorlet{CaptionColor}{blue}
\colorlet{AlertColor}{red}

\colorlet{HeadlineTextColor}{blue}
\colorlet{FootlineTextColor}{black!60}


%%%%%-- End of BASIC THEME --%%%%%
\fi
\fi
\fi
\fi
\fi

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%                        Configure visual aspects
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Change block environment
\newenvironment{mblock}[1]{
	\setbeamercolor{block body}{bg=mblockBgColor}
	\setbeamercolor{block title}{fg=mblockTitleTextColor,bg=mblockTitleBgColor}
	\begin{block}{#1}}{\end{block}}

% Create a definition environment
\newenvironment{defnt}[1]{
	\setbeamercolor{block body}{bg=defntBgColor}
	\setbeamercolor{block title}{fg=defntTitleTextColor,bg=defntTitleBgColor}
	\begin{block}{#1}}{\end{block}}

% Create a theorem environment
\newenvironment{thm}[1]{
	\setbeamercolor{block body}{bg=thmBgColor}
	\setbeamercolor{block title}{fg=thmTitleTextColor,bg=thmTitleBgColor}
	\begin{block}{#1}}{\end{block}}

% Set colors for text, titles, etc.
\setbeamercolor{title}{fg=TitleTextColor,bg=TitleBgColor}
\setbeamercolor{frametitle}{fg=TitleTextColor}
\setbeamercolor{alerted text}{fg=AlertColor}
\setbeamercolor{block title}{fg=MainColor}
\setbeamercolor{item projected}{bg=MainColor}
\setbeamercolor{item}{fg=MainColor}
\setbeamercolor{caption name}{fg=CaptionColor}
\setbeamercolor{normal text}{fg=NormalTextColor,bg=BgColor}
\hypersetup{pdfborder={0 0 0},colorlinks=true,linkcolor=MainColor,urlcolor=MainColor,citecolor=LinkColor}

\setbeamercolor{mgreen}{fg=mgreen}
\setbeamercolor{mred}{fg=mred}
\setbeamercolor{mblue}{fg=mblue}


%%%%%-- Numbering in a footer --%%%%%
\if@doFootNumber

% Set beamer headline
\setbeamertemplate{headline}{
	\leavevmode
	\hbox{
		\begin{beamercolorbox}[wd=\paperwidth,ht=2.5ex,dp=1.125ex]{blue}
			~~~~\insertsection
		\end{beamercolorbox}
	}
}

% Set beamer footline
\setbeamertemplate{footline}[text line]{
	\hfill\strut{
		\scriptsize\sf\color{black!60}
		\quad\insertframenumber
	}
	\hfill
}

%%%%%-- Numbering in a header --%%%%%
\else
\if@doHeadNumber

% Set beamer headline
\setbeamertemplate{headline}{
	\leavevmode
	\hbox{
		\begin{beamercolorbox}[wd=\paperwidth,ht=2.5ex,dp=1.125ex]{blue}
			~~~~\insertsection \hfill\color{MainColor}\insertframenumber\,/\,\inserttotalframenumber~~~~\hfill
		\end{beamercolorbox}
	}
}

%%%%%-- No numbering --%%%%%
\else

% Set beamer headline
\setbeamertemplate{headline}{
	\leavevmode
	\hbox{
		\begin{beamercolorbox}[wd=\paperwidth,ht=2.5ex,dp=1.125ex]{blue}
			~~~~\insertsection
		\end{beamercolorbox}
	}
}

\fi
\fi

% Set a watermark picture in the background
\if@doWatermark

\setbeamertemplate{background}{%
    \begin{tikzpicture}[overlay,remember picture]
    \node[anchor=south east,scale=1] at ([shift={(0.14cm,-0.12cm)}]current page.south east) {\includegraphics[width=3.3cm]{figure-files/placeholder.png}};
    \end{tikzpicture}%
}

\fi

% Set beamer frametitle
\makeatletter
\pgfdeclarehorizontalshading[FrameTitleLeft,FrameTitleRight]
{beamer@frametitleshade}
{\paperheight}{%
	color(0pt)=(FrameTitleLeft);
	color(\paperwidth)=(FrameTitleRight)}

\setbeamertemplate{frametitle}{
	\ifbeamercolorempty[bg]{frametitle}{}{\nointerlineskip}
	\hbox{\leavevmode
		\beamer@tempdim=\textwidth%
		\advance\beamer@tempdim by \beamer@leftmargin%
		\advance\beamer@tempdim by \beamer@rightmargin%
		\hskip-\Gm@lmargin\hbox{%
			\setbox\beamer@tempbox=\hbox{\begin{minipage}[b]{\paperwidth}%
					\vbox{}\vskip-0.255ex%
					\leftskip0.14cm%
					\strut\insertframetitle\par
					\ifx\insertframesubtitle\@empty%
					\else
					\par{\usebeamerfont*{framesubtitle}{\usebeamercolor[fg]{framesubtitle}\insertframesubtitle}\strut\par}%
					\fi%
					\nointerlineskip
					\vbox{}%
			\end{minipage}}%
			\beamer@tempdim=\ht\beamer@tempbox%
			\advance\beamer@tempdim by 4pt%
			\begin{pgfpicture}{0pt}{0pt}{\paperwidth}{\beamer@tempdim}
				\usebeamercolor{frametitle right}
				\pgfpathrectangle{\pgfpointorigin}{\pgfpoint{\paperwidth}{\beamer@tempdim}}
				\pgfusepath{clip}
				\pgftext[left,base]{\pgfuseshading{beamer@frametitleshade}}
			\end{pgfpicture}
			\hskip-\paperwidth%
			\box\beamer@tempbox%
		}%
		\hskip-\Gm@rmargin%
	}%
	\vskip-2pt
}
\makeatother

% Remove navigation symbols
\setbeamertemplate{navigation symbols}{}

% Set itemize symbols
\setbeamertemplate{enumerate items}{$\bullet$}
\setbeamertemplate{itemize items}{$\bullet$}
\setbeamertemplate{itemize subitem}{\footnotesize$\bullet$}

% Set beamer transparency of cover / uncover
\setbeamercovered{transparent}
